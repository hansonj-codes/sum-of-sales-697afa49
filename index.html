<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sales Summary 374959384</title>
  <!-- Bootstrap 5 CSS from jsDelivr CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Simple page styling */
    body { padding-top: 4rem; background-color: #f8f9fa; }
    .card { max-width: 720px; margin: 0 auto; }
    .spinner-center { display:flex; align-items:center; justify-content:center; height:200px; }
    #total-sales { font-size: 2rem; font-weight: 600; }
  </style>
</head>
<body>
  <main class="container">
    <div class="card shadow-sm">
      <div class="card-body">
        <h1 class="card-title mb-3">Sales Summary</h1>
        <p class="text-muted">This page reads data.csv, sums the <code>sales</code> column and displays the total.</p>

        <div id="status" class="mb-3">
          <div class="spinner-border text-primary" role="status" id="loading-spinner">
            <span class="visually-hidden">Loading...</span>
          </div>
          <span id="loading-text" class="ms-2">Loading data...</span>
        </div>

        <div class="mb-3">
          <div class="border rounded p-3 bg-white">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <div class="text-muted">Total Sales</div>
                <div id="total-sales">0.00</div>
              </div>
              <img src="githhub_sample.jpeg" alt="sample" style="height:64px; opacity:0.85;">
            </div>
          </div>
        </div>

        <div class="text-muted small">
          Note: If the CSV is updated in the repository, the page will reflect the updated total after a refresh.
        </div>
      </div>
    </div>
  </main>

  <!-- Bootstrap 5 JS (bundle) from jsDelivr CDN -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Immediately ensure title is set as required by tests
    document.title = 'Sales Summary 374959384';

    // Utility: parse a CSV string into rows (simple parser sufficient for this CSV)
    function parseCSV(csvText) {
      // Split into lines and handle CRLF
      const lines = csvText.trim().split(/\\r?\\n/);
      if (lines.length === 0) return { headers: [], rows: [] };
      const headers = lines[0].split(',').map(h => h.trim());
      const rows = [];
      for (let i = 1; i < lines.length; i++) {
        if (!lines[i].trim()) continue;
        // Split by comma - this CSV has no quoted commas so a simple split is fine
        const parts = lines[i].split(',').map(p => p.trim());
        const obj = {};
        for (let j = 0; j < headers.length; j++) {
          obj[headers[j]] = parts[j] !== undefined ? parts[j] : '';
        }
        rows.push(obj);
      }
      return { headers, rows };
    }

    async function fetchAndSumCSV() {
      try {
        const resp = await fetch('data.csv', { cache: 'no-store' });
        if (!resp.ok) throw new Error('Failed to fetch data.csv: ' + resp.status);
        const text = await resp.text();
        const { headers, rows } = parseCSV(text);

        // Find sales column case-insensitively
        const salesKey = headers.find(h => h.toLowerCase() === 'sales');
        if (!salesKey) throw new Error('No sales column found in CSV');

        let total = 0;
        for (const row of rows) {
          const raw = row[salesKey];
          // Parse number with tolerance for currency symbols/commas
          const cleaned = String(raw).replace(/[^0-9.+-eE]/g, '');
          const val = parseFloat(cleaned);
          if (!isNaN(val)) total += val;
        }

        // Display with two decimal places
        document.getElementById('total-sales').textContent = total.toFixed(2);

        // Hide loading
        document.getElementById('loading-spinner').style.display = 'none';
        document.getElementById('loading-text').textContent = 'Loaded';
        return total;
      } catch (err) {
        // Show error message in UI for transparency
        document.getElementById('loading-spinner').style.display = 'none';
        document.getElementById('loading-text').textContent = 'Error loading data';
        document.getElementById('total-sales').textContent = '0.00';
        console.error(err);
        return null;
      }
    }

    // Run on load
    window.addEventListener('load', () => {
      fetchAndSumCSV();
    });
  </script>
</body>
</html>